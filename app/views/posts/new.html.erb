<% provide(:title, "投稿を作成する") %>

<div class="new-post">
  <div class="container pt-md-5">
    <h1 class="pt-5 pb-1">投稿を作成する</h1>
    <div class="form_group mt-md-5 pl-md-5">
      <%= form_with model: @post, local: true do |form| %>
        <%= form.hidden_field :user_id, value: current_user.id %>

        <div class="form-row mb-4">
          <%= form.label :見つけた生き物, class: "mr-1" %>
          <%= form.text_field :found_animal %><span class="must ml-1">必須</span>
        </div>

        <div class="form-row mb-4">
          <%= form.label :ジャンル, class: "mr-5" %>
          <%= form.collection_select(:category_id, Category.all, :id, :category) %><span class="must ml-1">必須</span>
        </div>

        <div class="form-row mb-4">
          <%= form.label :発見場所, class: "mr-5" %>
          <%= form.collection_select(:prefecture_id, Prefecture.all, :id, :prefecture) %><span class="must ml-1">必須</span>
        </div>
        <div id='gmap'></div>

        <div class="form-row mb-4">
          <%= form.label :発見年／月, class: "mr-4" %>
          <%= form.date_select(:found_date, date_separator: "/", discard_day: true) %><span class="must ml-1">必須</span>
        </div>

        <div class="form-row mb-4">
          <%= form.label :コメント, class: "mr-5" %>
          <%= form.text_area :content, size: "30x5" %>
        </div>

        <div class="form-row mb-4">
          <%= form.label :画像を選択する, class: "mr-4" %><br>
          <%= form.file_field :image, id: "file" %>
          <%= form.hidden_field :image_cache %>
        </div>
        <div class="image-preview pb-4">
          <p id="preview"></p>
          <img id="preview-image" >
        </div>

        <div class="form-row mb-md-4 mx-auto pb-5 ">
          <%= form.submit "投稿する", class: "btn  btn-lg btn-success" %>
        </div>

      <% end %>
    </div>
  </div>

<style>
#gmap {
  height: 300px;
  width: 500px;
  margin-left: 7rem;
  margin-bottom: 2rem;
}
</style>

<script>
let map;
function initMap(){
  map = new google.maps.Map(document.getElementById('gmap'), {
    center: {lat: 38, lng:140.5},
    zoom: 12,
  });

  let marker = new google.maps.Marker({
    position: map.getCenter(),
    map: map
  });
  marker.setDraggable(true);

}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwf221uzw_nqcoGVja1gAaxh3iKfdq8ec&callback=initMap" async defer></script>

</div>